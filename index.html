<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dynamic Links from GitHub with Bootstrap</title>
    <meta name="description" content="A web page that displays dynamic links from GitHub using Bootstrap framework.">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <style>
        .search-box {
            margin-bottom: 20px;
            border-radius: 25px;
            padding: 10px 20px;
            font-size: 16px;
        }
        .loading {
            text-align: center;
            padding: 20px;
            font-size: 20px;
        }
        .category-list {
            position: sticky;
            top: 70px; /* Adjust based on your header height */
        }
        .search-tip {
            font-size: 14px;
            color: #888;
            margin-bottom: 10px;
        }
        .link-list {
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container mt-5">
        <div class="row">
            <div class="col-12 col-md-3">
                <input type="text" class="search-box form-control" placeholder="Search..." aria-label="Search">
                <div class="search-tip">Search for categories or links.</div>
                <div id="category-list" class="category-list list-group mt-3">
                    <!-- Category list will be dynamically generated -->
                </div>
            </div>
            <div class="col-12 col-md-9">
                <div id="links-container">
                    <!-- Links will be dynamically generated -->
                </div>
                <div id="loading" class="loading" style="display: none;">Loading...</div>
            </div>
        </div>
    </div>
    <!-- Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://ajax.aspnetcdn.com/ajax/jQuery/jquery-3.7.1.min.js"></script>
    <script>
        var jsonUrl = 'https://testingcf.jsdelivr.net/gh/lxl-xiaolong/lxl-xiaolong.github.io@master/json/links_20240626135533.json';

        function getJsonAndGenerateHtml() {
            $('#loading').show();
            $.ajax({
                url: jsonUrl,
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    $('#loading').hide();
                    var categoryList = $('#category-list');
                    var linksContainer = $('#links-container');

                    // Generate category list
                    data.categories.forEach(function(category) {
                        var categoryId = category.name.toLowerCase().replace(/\s+/g, '-');
                        categoryList.append($('<button type="button" class="list-group-item list-group-item-action"></button>')
                            .text(category.name)
                            .click(function() {
                                linksContainer.empty(); // Clear previous results
                                var matchedLinks = category.links.map(function(link) {
                                    return $('<li class="list-group-item"></li>').append(
                                        $('<a href="' + link.url + '" target="_blank" class="text-decoration-none"></a>').text(link.name)
                                    );
                                });
                                linksContainer.append($('<ul class="list-group list-unstyled link-list"></ul>').append(matchedLinks));
                            }));
                    });

                    // Search functionality
                    $('.search-box').on('keyup', function() {
                        var query = $(this).val().toLowerCase();
                        linksContainer.empty(); // Clear previous results

                        if (query === '') {
                            // If the search box is empty, don't display any links
                            return;
                        }

                        // Filter links based on the search query across all categories
                        var filteredLinks = data.categories.reduce(function(acc, category) {
                            return acc.concat(category.links.filter(function(link) {
                                return link.name.toLowerCase().includes(query);
                            }));
                        }, []);

                        // Create an unordered list for the filtered links
                        var ul = $('<ul class="list-group list-unstyled link-list"></ul>');
                        filteredLinks.forEach(function(link) {
                            ul.append($('<li class="list-group-item"></li>').append(
                                $('<a href="' + link.url + '" target="_blank" class="text-decoration-none stretched-link"></a>').text(link.name)
                            ));
                        });

                        // Append the list to the container
                        linksContainer.append(ul);
                    });
                },
                error: function(error) {
                    $('#loading').hide();
                    console.error('There has been a problem with your fetch operation:', error);
                }
            });
        }
        getJsonAndGenerateHtml();
    </script>
</body>
</html>
