<!DOCTYPE html>
<html lang="zh-CN">
	<head>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>糖糖π的资源站</title>
		<link href="https://cdn.bootcdn.net/ajax/libs/layui/2.9.15/css/layui.css" rel="stylesheet">
		<link rel="stylesheet" href="https://jsdelivr.pai233.top/npm/font-awesome/css/font-awesome.min.css">
	</head>
	<body class="layui-container">
		<div class="layui-text">
			<h1 id="timeDateWeek"></h1>
			<h1>糖糖π的资源站</h1>
			<h2 style="text-align: right;">——热衷于分享安全，无毒，无后门，可靠可用的各类资源。</h2>
			<h3 id="hitokoto_text">:D 获取中...</h3>
			<div class="layui-text" style="text-align: center; margin-top: 20px;">
				<button id="searchBtn" type="button" class="layui-btn layui-btn-fluid layui-bg-blue">搜索资源</button>
			</div>
		</div>
		<div class="layui-row" id="linksPanel"></div>
		<div class="layui-text">
			<p>Copyright © 2024 刘小龙</p>
			<p>网站托管提供商 <a target="_blank" href="https://pages.github.com/">GitHub</a></p>
			<p id="uptime"></p>
			<div>
				<span class="social-value">富强</span>
				<span class="social-value">民主</span>
				<span class="social-value">文明</span>
				<span class="social-value">和谐</span>
				<span>|</span>
				<span class="social-value">自由</span>
				<span class="social-value">平等</span>
				<span class="social-value">公正</span>
				<span class="social-value">法治</span>
				<span>|</span>
				<span class="social-value">爱国</span>
				<span class="social-value">敬业</span>
				<span class="social-value">诚信</span>
				<span class="social-value">友善</span>
			</div>
		</div>
		<script src="https://cdn.bootcdn.net/ajax/libs/layui/2.9.15/layui.js"></script>
		<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
		<script src="https://jsdelivr.pai233.top/gh/Fuukei/Public_Repository@latest/static/js/sakura-less.js"></script>
		<script src="https://jsdelivr.pai233.top/gh/lxl-xiaolong/lxl-xiaolong.github.io@master/js/autoload.js"></script>
		<script src="https://jsdelivr.pai233.top/gh/lxl-xiaolong/lxl-xiaolong.github.io@master/js/getRandomColor.js">
		</script>
		<script src="https://jsdelivr.pai233.top/gh/lxl-xiaolong/lxl-xiaolong.github.io@master/js/date.js"></script>
		<script src="https://jsdelivr.pai233.top/gh/lxl-xiaolong/lxl-xiaolong.github.io@master/js/Hitokoto.js"></script>
		<script src="https://jsdelivr.pai233.top/gh/lxl-xiaolong/lxl-xiaolong.github.io@master/js/jia_zhi_guan.js">
		</script>
		<script src="https://jsdelivr.pai233.top/gh/lxl-xiaolong/lxl-xiaolong.github.io@master/js/shu_biao_dian_ji.js">
		</script>
		<script src="https://jsdelivr.pai233.top/gh/lxl-xiaolong/lxl-xiaolong.github.io@master/js/si_dai.js"></script>
		<script
			src="https://jsdelivr.pai233.top/gh/lxl-xiaolong/lxl-xiaolong.github.io@master/js/wang_zhan_yun_xing_shi_jian.js">
		</script>
		<script src="https://jsdelivr.pai233.top/gh/lxl-xiaolong/lxl-xiaolong.github.io@master/js/zhi_zhu_wang.js">
		</script>
		<script>
			layui.use(['element', 'layer', 'util'], function() {
				var element = layui.element;
				var layer = layui.layer;
				var util = layui.util;
				var JSONURL =
					'https://jsdelivr.pai233.top/gh/lxl-xiaolong/lxl-xiaolong.github.io@master/json/links_20240820184335.json';

				// 加载层
				var loading = layer.msg('正在加载中，请稍后...', {
					icon: 16,
					shade: [0.1, '#fff']
				});

				// 使用XMLHttpRequest获取JSON数据
				var xhr = new XMLHttpRequest();
				xhr.open('GET', JSONURL, true);
				xhr.onreadystatechange = function() {
					if (xhr.readyState === 4) {
						layer.close(loading); // 关闭加载层
						if (xhr.status === 200) {
							var data = JSON.parse(xhr.responseText);
							generatePanels(data);
							layer.msg('数据加载成功！', {
								icon: 6
							});
						} else {
							layer.msg('数据加载失败！', {
								icon: 5
							});
						}
					}
				};
				xhr.onerror = function() {
					layer.close(loading); // 关闭加载层
					layer.msg('网络错误，请检查您的网络连接！');
				};
				xhr.send();

				// 生成折叠面板
				function generatePanels(data) {
					var html = '';
					var rows = Math.ceil(data.length / 4); // 计算需要的行数
					for (var i = 0; i < rows; i++) {
						html += '<div class="layui-row">';
						for (var j = 0; j < 4; j++) {
							var index = i * 4 + j;
							if (index < data.length) {
								html += generatePanel(data[index]);
							}
						}
						html += '</div>';
					}
					document.getElementById('linksPanel').innerHTML = html;
					element.init(); // 初始化折叠面板
				}

				// 生成单个折叠面板
				function generatePanel(category) {
					var panelHtml = '';
					panelHtml += '<div class="layui-col-md3 layui-col-xs12">';
					panelHtml += '<div class="layui-collapse" lay-accordion="">'; // 添加 lay-accordion 属性以启用动画
					panelHtml += '<div class="layui-colla-item">';
					panelHtml += '<h2 class="layui-colla-title">' + category.name + '</h2>';
					panelHtml += '<div class="layui-colla-content">'; // 默认折叠
					category.links.forEach(function(link) {
						panelHtml += '<a href="' + link.url + '" target="_blank">' + link.name + '</a><br>';
					});
					panelHtml += '</div>';
					panelHtml += '</div>';
					panelHtml += '</div>';
					panelHtml += '</div>';
					return panelHtml;
				}

				// 返回顶部
				layui.use(['util'], function() {
					var util = layui.util;
					util.fixbar({
						top: true,
						css: {
							right: 15,
							bottom: 35
						},
						bgcolor: '#16889aa',
						click: function(type) {
							// 可以根据需要添加点击事件
						}
					});
				});
			});
		</script>
		<script>
			// 搜索功能
			document.getElementById('searchBtn').addEventListener('click', function() {
				layer.open({
					type: 1,
					anim: 4,
					title: '搜索资源',
					area: ['400px', '200px'],
					content: '<div style="margin: 20px;"><input type="text" id="searchInput" placeholder="请输入关键词" class="layui-input" /></div>',
					btn: ['确定', '取消'],
					yes: function(index, layero) {
						const keyword = document.getElementById('searchInput').value.trim();
						if (keyword) {
							fetchResources(keyword, index);
						} else {
							layer.msg('请输入关键词', {
								icon: 0
							});
						}
					}
				});
			});

			function fetchResources(keyword, index) {
				fetch(JSONURL)
					.then(response => {
						if (!response.ok) {
							throw new Error('Network response was not ok');
						}
						return response.json();
					})
					.then(data => {
						const searchResults = searchResources(data, keyword);
						displaySearchResults(searchResults);
						layer.close(index);
					})
					.catch(error => {
						console.error('Error:', error);
						layer.msg('获取数据失败，请稍后再试！', {
							icon: 5
						});
					});
			}

			function searchResources(data, keyword) {
				return data.reduce((results, category) => {
					const matchedLinks = category.links.filter(link => link.name.toLowerCase().includes(keyword
						.toLowerCase()));
					return results.concat(matchedLinks.map(link => ({
						category: category.name,
						name: link.name,
						url: link.url
					})));
				}, []);
			}

			function displaySearchResults(results) {
				if (results.length > 0) {
					const html = results.map(result => `
            <div class="search-result-item">
				<a style="display: block; margin-top: 10px; padding: 10px;" href="${result.url}" target="_blank">${result.name}</a>
            </div>
        `).join('');
					layer.open({
						type: 1,
						anim: 3,
						title: "搜索结果",
						area: ['800px', '600px'],
						content: `<div class="search-results">${html}</div>`
					});
				} else {
					layer.msg('没有找到相关资源，请尝试其他关键词！', {
						icon: 0
					});
				}
			}
		</script>
	</body>
</html>